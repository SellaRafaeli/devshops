<%
  is_seller ||= false
  o = order
%>
<% cast  = $casts.get(o[:cast_id]) %>
<% buyer = $users.get(o[:user_id]) %>

<%
  buyer = {} unless buyer # for example for manually-created orders which are initially empty
%>

<style>
.single_order_list {
  background-color: whitesmoke;
  padding: 10px;
  margin: 10px;
  margin-bottom: 30px;  
}
.single_order_details {
  display: flex;
}
.order_img {
  height: 50px;
  width: 50px;
}
.order_right {
  display: flex;
  align-items: center;
}

</style>

<div class='single_order_list_container'>
  <div class='single_order_list single_list_item'>    

    <%#= o.to_json %>        
    <div class='single_order_details'>
      <div class=flex2>
        <a class=simple_link href='/casts/<%=o[:cast_id]%>'>
          <img src='<%=cast[:img_url]%>' class='order_img' />
          <div><%= cast[:title] %></div>
        </a>
      </div>

      <div class=flex2>
        <a class=simple_link href='/users/<%=buyer[:_id]%>'>
          <% if buyer[:img_url] %>
          <img src='<%=buyer[:img_url]%>' class='order_img' />
          <div><%= buyer[:name] %></div>
          <% end %>
          <%#= buyer.to_json %>
        </a>
      </div>

      <div class='flex2'>
        <b> $<%= o[:amount].to_f/100 %> </b> 
        <div><%= nice_datetime(o[:created_at]) %></div>
      </div>

      <div class='flex5 order_right'>

        <div class=flex3>  
            <% if is_seller %>
              <select onchange="updateOrderStatus($(this).val(), '<%=o[:_id]%>')">
                <% ORDER_STATUSES.each do |status| %>
                  <option <%="selected" if o[:status]==status %> ><%=status%></option>
                <% end %>
              </select>        
            <% else %>
              <%= o[:status] %>
            <% end %>
        </div>
      </div>
    </div>
    <br/>
    <%= erb :'/partials/notes_box', locals: {item_id: o[:_id]} %>
  </div>  

</div>
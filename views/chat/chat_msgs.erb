<%  
  # msgs_crit[:created_at] = {'$gt': locals[:msgs_since]} if locals[:msgs_since]
  msgs_crit   = {cast_id: cast_id, status: CHAT_MSG_OK}
  chat_msgs   = $chat.get_many(msgs_crit)
  chat_videos ||= false
%> 

<style>
.chat_msg_content a {
  color: goldenrod;
  font-weight: bold;
}
.chat_msg_content a:hover {
  color: grey;
}
.user_type {
  display: inline-block;
  padding: 5px;
  padding: 5px;
  width: 20px;
  margin-left: 10px;
}
.user_name {
  width: 300px;
}
</style>

<!-- <script src="https://unpkg.com/peerjs@1.2.0/dist/peerjs.min.js"></script> -->

<div style='max-height: 300px;'>
<% if !chat_msgs.any? %>
<div>No messages yet, be the first.</div>
<% end %>
<% chat_msgs.each do |msg| %>
<%#= msg.to_json %>
  <div class='chat_msg' data-date="<%=msg[:created_at]%>">    
    <a target=blank href='/users/<%=msg[:user_id]%>' class='chat_name'>
      <span class='chat_user_img'><img src="<%=msg[:img_url]%>" /> </span>
      <span class='user_type'> <%=user_type_logo(msg[:type]) %>  </span>
      <span class='user_name'> <%=msg[:name]%> </span>

    </a> 
    <span class='chat_msg_content'><%= escape_html msg[:message] %> </span>
    <span class="chat_date" data-date="<%=msg[:created_at]%>"><%=time_ago msg[:created_at]%></span></div>
<% end %>
</div>